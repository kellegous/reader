syntax = "proto3";

package reader;
option go_package = "github.com/kellegous/reader";

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

service Reader {
  rpc CheckHealth(google.protobuf.Empty) returns (google.protobuf.Empty) {}
  rpc GetEntries(GetEntriesRequest) returns (GetEntriesResponse) {}
  rpc GetEntriesByWeek(GetEntriesByWeekRequest)
      returns (GetEntriesByWeekResponse) {}
}

message GetEntriesRequest {
  enum SortKey {
    PUBLISHED_AT = 0;
    ID = 1;
    STATUS = 2;
  }
  enum Order {
    ASC = 0;
    DES = 1;
  }
  google.protobuf.Timestamp published_after = 1;
  google.protobuf.Timestamp published_before = 2;
  SortKey sort_key = 3;
  Order order = 4;
}

message GetEntriesResponse { repeated Entry entries = 1; }

message GetEntriesByWeekRequest {
  enum WeekDay {
    SUNDAY = 0;
    MONDAY = 1;
    TUESDAY = 2;
    WEDNESDAY = 3;
    THURSDAY = 4;
    FRIDAY = 5;
    SATURDAY = 6;
  }

  message FromWeekToWeek {
    google.protobuf.Timestamp from_week_of = 1;
    google.protobuf.Timestamp to_week_of = 2;
  }

  message NWeeksFromWeek {
    google.protobuf.Timestamp from_week_of = 1;
    uint32 n_weeks = 2;
  }

  oneof range {
    FromWeekToWeek from_week_to_week = 1;
    NWeeksFromWeek n_weeks_from_week = 2;
  }

  WeekDay week_starts_day = 3;
}

message GetEntriesByWeekResponse {
  message WeekOfEntries {
    Week week = 1;
    repeated Entry entries = 2;
  }
  repeated WeekOfEntries weeks_of_entries = 1;
}

message Week {
  google.protobuf.Timestamp begins_at = 1;
  google.protobuf.Timestamp ends_at = 2;
}

message Entry {
  int64 id = 1;
  google.protobuf.Timestamp published_at = 2;
  google.protobuf.Timestamp changed_at = 3;
  google.protobuf.Timestamp created_at = 4;
  Feed feed = 5;
  string url = 6;
  string title = 7;
  string content = 8;
  int32 reading_time = 9;
}

message Feed {
  int64 id = 1;
  string feed_url = 2;
  string site_url = 3;
  string title = 4;
}