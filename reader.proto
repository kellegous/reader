syntax = "proto3";

package reader;
option go_package = "github.com/kellegous/reader";

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

service Reader {
  rpc CheckHealth(google.protobuf.Empty) returns (google.protobuf.Empty) {}
  rpc GetEntries(GetEntriesRequest) returns (GetEntriesResponse) {}
  rpc GetMe(google.protobuf.Empty) returns (GetMeResponse) {}
  rpc GetEntryText(GetEntryTextRequest) returns (GetEntryTextResponse) {}
  rpc SetEntryStatus(SetEntryStatusRequest) returns (google.protobuf.Empty) {}
  rpc GetConfig(google.protobuf.Empty) returns (GetConfigResponse) {}
}

message GetEntryTextRequest { int64 entry_id = 1; }

message GetEntryTextResponse { string text = 1; }

message GetEntriesRequest {
  enum SortKey {
    PUBLISHED_AT = 0;
    ID = 1;
    STATUS = 2;
  }
  enum Order {
    ASC = 0;
    DESC = 1;
  }
  google.protobuf.Timestamp published_after = 1;
  google.protobuf.Timestamp published_before = 2;
  SortKey sort_key = 3;
  Order order = 4;
  bool include_content = 5;
}

message GetEntriesResponse { repeated Entry entries = 1; }

message GetMeResponse { User user = 1; }

message GetConfigResponse { Config config = 1; }

message SetEntryStatusRequest {
  int64 entry_id = 1;
  Status status = 2;
}

message Config {
  message Ollama {
    string url = 1;
    string model = 2;
  }
  Ollama ollama = 1;
}

message User {
  int64 id = 1;
  string username = 2;
  bool is_admin = 3;
  string theme = 4;
  string language = 5;
  string timezone = 6;
}

enum Status {
  UNREAD = 0;
  READ = 1;
  REMOVED = 2;
}

message Entry {
  int64 id = 1;
  google.protobuf.Timestamp published_at = 2;
  google.protobuf.Timestamp changed_at = 3;
  google.protobuf.Timestamp created_at = 4;
  Feed feed = 5;
  string url = 6;
  string title = 7;
  string content = 8;
  int32 reading_time = 9;
  Status status = 10;
}

message Feed {
  int64 id = 1;
  string feed_url = 2;
  string site_url = 3;
  string title = 4;
  string icon_data_url = 5;
}